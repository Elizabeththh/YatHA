<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YATHA 热词分析系统</title>
    
    <link rel="stylesheet" href="styles.css">
    
    <!-- 引入Chart.js图表库 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- 引入词云库 -->
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
    
    <!-- 引入主脚本 (defer确保DOM加载完成后执行) -->
    <script src="script.js" defer></script>

</head>

<body>
    <!-- Logo和标题 -->
    <div style="text-align: center; margin-bottom: 20px;">
        <h1>YATHA 热词分析</h1>
    </div>

    <!-- Tab切换容器 -->
    <div class="tab-container">
        <div class="tab-header">
            <button class="tab-btn active" onclick="switchTab('direct')">直接分析</button>
            <button class="tab-btn" onclick="switchTab('rolling')">滚动分析</button>
        </div>

        <!-- Tab 1: 直接分析 (原有功能) -->
        <div id="directTab" class="tab-content active">
            <div class="container">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <p>点击上传文件或拖拽文件到此处</p>
                    <p style="font-size: 0.8em; color: #888;">支持 .txt 格式</p>
                    <input type="file" id="fileInput" accept=".txt">
                </div>

                <div id="fileStatus" style="margin: 15px 0; color: #666; display: none;">
                    <p>文件就绪: <span id="fileName"></span></p>
                </div>

                <button id="analyzeBtn" class="btn btn-success" style="display: none; margin-bottom: 20px; font-size: 18px; padding: 12px 30px;" onclick="startAnalysis()">
                    开始分析
                </button>

        <!-- 词性过滤选项 -->
        <div class="pos-filter-section">
            <div class="collapse-header" onclick="togglePosFilter()">
                <span><strong>词性过滤设置</strong> (可选)</span>
                <span id="collapseIcon">▼</span>
            </div>

            <div id="posFilterContent" class="collapse-content">
                <!-- 模式选择 -->
                <div class="mode-selector">
                    <span style="font-weight: bold;">模式：</span>
                    <input type="radio" name="filterMode" id="modeNone" value="none" checked>
                    <label for="modeNone">不过滤</label>

                    <input type="radio" name="filterMode" id="modeFilter" value="filter">
                    <label for="modeFilter">过滤模式</label>

                    <input type="radio" name="filterMode" id="modeAllow" value="allow">
                    <label for="modeAllow">放行模式</label>
                </div>

                        <!-- 快速选择 -->
                        <div class="quick-select">
                            <button onclick="selectAllPos()">全选</button>
                            <button onclick="deselectAllPos()">清空</button>
                        </div>

                        <!-- 词性分类 -->
                        <div id="directPosCategories">

                <!-- 名词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">名词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="n"> n - 名词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="nr"> nr - 人名</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="ns"> ns - 地名</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="nt"> nt -
                            机构团体</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="nz"> nz -
                            其他专名</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="nrt"> nrt -
                            音译名</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="nrfg"> nrfg -
                            音译人名</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="ng"> ng -
                            名词性语素</label>
                    </div>
                </div>

                <!-- 动词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">动词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="v"> v - 动词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="vg"> vg -
                            动词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="vn"> vn - 名动词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="vd"> vd - 副动词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="vq"> vq - 动量词</label>
                    </div>
                </div>

                <!-- 形容词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">形容词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="a"> a - 形容词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="ag"> ag -
                            形容词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="ad"> ad - 副形词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="an"> an - 名形词</label>
                    </div>
                </div>

                <!-- 副词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">副词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="d"> d - 副词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="dg"> dg -
                            副词性语素</label>
                    </div>
                </div>

                <!-- 数量词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">数量词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="m"> m - 数词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="mg"> mg -
                            数词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="mq"> mq - 数量词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="q"> q - 量词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="qg"> qg -
                            量词性语素</label>
                    </div>
                </div>

                <!-- 代词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">代词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="r"> r - 代词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="rg"> rg -
                            代词性语素</label>
                    </div>
                </div>

                <!-- 虚词类 -->
                <div class="pos-category">
                    <div class="pos-category-title">虚词类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="p"> p - 介词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="c"> c - 连词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="u"> u - 助词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="ug"> ug -
                            助词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="uj"> uj -
                            助词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="f"> f - 方位词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="b"> b - 区别词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="bg"> bg -
                            区别语素</label>
                    </div>
                </div>

                <!-- 时空类 -->
                <div class="pos-category">
                    <div class="pos-category-title">时空类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="t"> t - 时间词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="tg"> tg -
                            时间词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="s"> s - 处所词</label>
                    </div>
                </div>

                <!-- 其他类 -->
                <div class="pos-category">
                    <div class="pos-category-title">其他类</div>
                    <div class="pos-grid">
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="x"> x - 标点符号</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="e"> e - 叹词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="o"> o - 拟声词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="y"> y - 语气词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="i"> i - 成语</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="l"> l - 习用语</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="j"> j - 简称</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="jn"> jn -
                            简称名词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="z"> z - 状态词</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="zg"> zg -
                            状态词性语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="k"> k - 后接成分</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="g"> g - 语素</label>
                        <label class="pos-item"><input type="checkbox" class="pos-checkbox" value="eng"> eng -
                            英文/外语</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h3>分析结果:</h3>
                <div id="result">请上传文件以查看分析结果...</div>
            </div>
        </div>

        <!-- Tab 2: 滚动分析 -->
        <div id="rollingTab" class="tab-content">
            <div class="container">
                <div class="rolling-layout">
                    <!-- 时间轴显示 -->
                    <div class="timeline-display">
                        <div style="font-size: 14px; opacity: 0.9;">当前时间</div>
                        <div class="time-value" id="currentTime">00:00:00</div>
                        <div class="window-info">
                            窗口大小: <span id="displayWindowSize">60</span>秒
                        </div>
                    </div>
                    
                    <!-- 图表展示区（柱状图和词云图左右分布） -->
                    <div class="charts-container">
                        <!-- 左侧柱状图 -->
                        <div class="chart-wrapper">
                            <h3 style="text-align: center; margin-bottom: 15px; color: #333;">TopK 热词排行榜</h3>
                            <canvas id="wordFreqChart"></canvas>
                        </div>
                        
                        <!-- 右侧词云图 -->
                        <div class="wordcloud-wrapper">
                            <h3 style="text-align: center; margin-bottom: 15px; color: #333;">词云可视化</h3>
                            <canvas id="wordCloudCanvas" width="1200" height="600" style="width: 100%; border: 1px solid #ddd; border-radius: 8px; background: white;"></canvas>
                        </div>
                    </div>

                    <!-- 下方控制面板 -->
                    <div class="rolling-control-panel">
                        <h3>控制面板</h3>
                        
                        <div class="control-grid">
                            <!-- 文件上传 -->
                            <div class="control-group">
                                <div class="rolling-upload-area" onclick="document.getElementById('rollingFileInput').click()">
                                    <p>上传文件</p>
                                    <p style="font-size: 0.8em; color: #888;">.txt 格式</p>
                                    <input type="file" id="rollingFileInput" accept=".txt">
                                </div>
                                <div id="rollingFileStatus" style="display: none;">
                                    文件: <span id="rollingFileName"></span>
                                    <span class="status-badge ready">就绪</span>
                                </div>
                            </div>

                            <!-- 时间窗口设置 -->
                            <div class="control-group">
                                <label for="windowSize">时间窗口 (秒)</label>
                                <input type="number" id="windowSize" value="60" min="1" max="3600" placeholder="60">
                                <small style="color: #888;">在分析开始后不可更改</small>
                            </div>

                            <!-- TopK设置 -->
                            <div class="control-group">
                                <label for="topKInput">TopK 数量</label>
                                <input type="number" id="topKInput" value="10" min="1" max="50" placeholder="10">
                                <small style="color: #888;">在分析开始后不可更改</small>
                            </div>

                            <!-- 时间步长 -->
                            <div class="control-group">
                                <label for="playSpeed">时间步长(秒)</label>
                                <input type="number" id="playSpeed" value="1" min="1" max="3600" placeholder="1">
                                <small style="color: #888;">在分析开始后不可更改</small>
                            </div>

                            <!-- 词性过滤 -->
                            <div class="control-group">
                                <label>词性过滤</label>
                                <button class="pos-config-btn" onclick="openRollingPosModal()">
                                    <span id="rollingPosConfigText">不过滤</span>
                                    <span class="pos-config-status" id="rollingPosConfigStatus">点击配置</span>
                                </button>
                            </div>
                        </div>

                        <!-- 控制按钮 -->
                        <div class="control-buttons">
                            <button id="startRolling" class="btn btn-success" onclick="startRollingAnalysis()">
                                开始滚动分析
                            </button>
                            <button id="stopRolling" class="btn btn-danger" onclick="stopRollingAnalysis()" disabled>
                                停止分析
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 滚动分析词性过滤模态框 -->
    <div id="rollingPosModal" class="modal-overlay" onclick="closeRollingPosModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>词性过滤设置</h3>
                <button class="modal-close" onclick="closeRollingPosModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 模式选择 -->
                <div class="mode-selector">
                    <span style="font-weight: bold;">模式：</span>
                    <input type="radio" name="rollingFilterMode" id="rollingModeNone" value="none" checked>
                    <label for="rollingModeNone">不过滤</label>

                    <input type="radio" name="rollingFilterMode" id="rollingModeFilter" value="filter">
                    <label for="rollingModeFilter">过滤模式</label>

                    <input type="radio" name="rollingFilterMode" id="rollingModeAllow" value="allow">
                    <label for="rollingModeAllow">放行模式</label>
                </div>

                <!-- 快速选择 -->
                <div class="quick-select">
                    <button onclick="selectAllRollingPos()">全选</button>
                    <button onclick="deselectAllRollingPos()">清空</button>
                </div>

                <!-- 词性分类 - 完整版 -->
                <div id="rollingPosCategories">
                    <!-- 名词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">名词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="n"> n - 名词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="nr"> nr - 人名</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="ns"> ns - 地名</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="nt"> nt - 机构团体</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="nz"> nz - 其他专名</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="nrt"> nrt - 音译名</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="nrfg"> nrfg - 音译人名</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="ng"> ng - 名词性语素</label>
                        </div>
                    </div>

                    <!-- 动词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">动词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="v"> v - 动词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="vg"> vg - 动词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="vn"> vn - 名动词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="vd"> vd - 副动词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="vq"> vq - 动量词</label>
                        </div>
                    </div>

                    <!-- 形容词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">形容词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="a"> a - 形容词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="ag"> ag - 形容词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="ad"> ad - 副形词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="an"> an - 名形词</label>
                        </div>
                    </div>

                    <!-- 副词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">副词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="d"> d - 副词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="dg"> dg - 副词性语素</label>
                        </div>
                    </div>

                    <!-- 数量词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">数量词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="m"> m - 数词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="mg"> mg - 数词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="mq"> mq - 数量词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="q"> q - 量词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="qg"> qg - 量词性语素</label>
                        </div>
                    </div>

                    <!-- 代词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">代词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="r"> r - 代词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="rg"> rg - 代词性语素</label>
                        </div>
                    </div>

                    <!-- 虚词类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">虚词类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="p"> p - 介词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="c"> c - 连词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="u"> u - 助词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="ug"> ug - 助词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="uj"> uj - 助词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="f"> f - 方位词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="b"> b - 区别词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="bg"> bg - 区别语素</label>
                        </div>
                    </div>

                    <!-- 时空类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">时空类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="t"> t - 时间词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="tg"> tg - 时间词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="s"> s - 处所词</label>
                        </div>
                    </div>

                    <!-- 其他类 -->
                    <div class="pos-category">
                        <div class="pos-category-title">其他类</div>
                        <div class="pos-grid">
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="x"> x - 标点符号</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="e"> e - 叹词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="o"> o - 拟声词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="y"> y - 语气词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="i"> i - 成语</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="l"> l - 习用语</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="j"> j - 简称</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="jn"> jn - 简称名词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="z"> z - 状态词</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="zg"> zg - 状态词性语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="k"> k - 后接成分</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="g"> g - 语素</label>
                            <label class="pos-item"><input type="checkbox" class="rolling-pos-checkbox" value="eng"> eng - 英文/外语</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn" style="background: #6c757d;" onclick="closeRollingPosModal()">取消</button>
                <button class="btn btn-success" onclick="confirmRollingPosConfig()">确定</button>
            </div>
        </div>
    </div>

</body>

</html>