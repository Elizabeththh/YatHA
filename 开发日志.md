## TODO
1. ~~è§„èŒƒå‘½åå˜é‡(é‡‡ç”¨é©¼å³°å‘½åæ³•)ï¼Œå¼•å…¥ Xmake æ”¯æŒè·¨å¹³å°ç¼–è¯‘~~    
2. ~~é…ç½®å¤–éƒ¨åŒ–ï¼Œé¿å… hardcode~~
3. ~~æ•æ„Ÿè¯è¿‡æ»¤~~ï¼ˆæ”¾å¼ƒï¼Œä¸æ˜¯æ²¡çœ¼çœ‹å°±æ˜¯æ²¡æ³•çœ‹ï¼‰
4. ~~è¯æ€§è¿‡æ»¤~~
5. ~~åŠ¨æ€æ»‘åŠ¨çª—å£å¤§å°~~
6. ~~äº¤äº’å¼å¯è§†åŒ–~~
7. ~~æœåŠ¡éƒ¨ç½²~~ï¼ˆæ‰¾ä¸åˆ°å¯ç”¨çš„æœåŠ¡å™¨/(ã„’oã„’)/~~ï¼‰
8. ~~CI/CD~~ï¼ˆåŒä¸Šï¼‰
9. ~~æ»šåŠ¨æŸ¥è¯¢ä¸å›¾è¡¨æ”¯æŒ~~

## v0.1 å®ŒæˆåŸºç¡€æ»‘åŠ¨çª—å£çƒ­è¯ç»Ÿè®¡åŠŸèƒ½
### é‡åˆ°çš„é—®é¢˜
#### 1. **è¾“å‡ºæ–‡ä»¶æ¯æ¬¡éƒ½è¢«è¦†ç›–çš„é—®é¢˜**
```cpp
        std::ofstream out(outputFile, std::ios::binary);
        countTopKWords(out);
```
   - **ç°è±¡**ï¼š`countTopKWords()` å‡½æ•°åœ¨æ¯æ¬¡æ‰§è¡Œ ACTION å‘½ä»¤æ—¶éƒ½ä¼šåˆ›å»ºæ–°çš„ `std::ofstream` å¯¹è±¡ï¼Œå¯¼è‡´æ–‡ä»¶è¢«è¦†ç›–ï¼Œåªèƒ½çœ‹åˆ°æœ€åä¸€æ¬¡çš„è¾“å‡º
   - **åŸå› **ï¼šåœ¨ `cutWord()` ä¸­æ¯æ¬¡é‡åˆ° ACTION æ—¶éƒ½æ‰§è¡Œ `std::ofstream out(outputFile, std::ios::binary);`ï¼Œé»˜è®¤æ¨¡å¼ä¸ºè¦†ç›–æ¨¡å¼
   æŸ¥é˜…èµ„æ–™å¾—åˆ°ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š
   - **è§£å†³æ–¹æ¡ˆ**ï¼š
     - æ–¹æ¡ˆ1ï¼šä½¿ç”¨è¿½åŠ æ¨¡å¼ `std::ios::binary | std::ios::app`
     - æ–¹æ¡ˆ2ï¼šå°† `ofstream` ä½œä¸ºç±»æˆå‘˜å˜é‡ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ‰“å¼€ï¼Œææ„å‡½æ•°ä¸­å…³é—­
     - æ–¹æ¡ˆ3ï¼šä½¿ç”¨é™æ€å˜é‡æ ‡è®°é¦–æ¬¡å†™å…¥ï¼Œé¦–æ¬¡è¦†ç›–ï¼Œåç»­è¿½åŠ 
   - **æ–¹æ¡ˆåˆ†æ**ï¼š
        - æ–¹æ¡ˆ1ï¼šå¦‚æœoutput.txtå·²å­˜åœ¨ï¼Œé‚£ä¹ˆæ¯æ¬¡è¿è¡Œç¨‹åºåoutput.txtéƒ½ä¼šå˜é•¿ï¼Œæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ
        - æ–¹æ¡ˆ2ï¼šå°†æ–‡ä»¶æµä½œä¸ºç±»æˆå‘˜ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ‰“å¼€ä¸€æ¬¡ï¼Œæ•´ä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼Œä¸”ç¡®ä¿æ¯æ¬¡è¿è¡Œéƒ½æ˜¯æ–°æ–‡ä»¶
        - æ–¹æ¡ˆ3ï¼šéœ€è¦é¢å¤–çš„é™æ€å˜é‡ç»´æŠ¤çŠ¶æ€ï¼Œå¢åŠ äº†å¤æ‚åº¦ï¼Œä¸”å¦‚æœåˆ›å»ºå¤šä¸ªHaEngineå¯¹è±¡ä¼šå‡ºç°é—®é¢˜
        æ•…é€‰æ‹©æ–¹æ¡ˆ2
```cpp
class haEngine
{
    private:
    ...
    std::ofstream out;
};

// åˆå§‹åŒ– jieba å’Œ swmanager
HaEngine::HaEngine(int window, int k, const std::string &i, const std::string &o) : 
jieba("../data/dict/jieba.dict.utf8",
      "../data/dict/hmm_model.utf8",
      "../data/dict/user.dict.utf8",
      "../data/dict/idf.utf8",
      "../data/dict/stop_words.utf8"),
swManager("../data/dict/stop_words.utf8"),
max_window_size(window), top_k(k), inputFile(i), outputFile(o) { out.open(outputFile, std::ios::binary); }
```

#### 2. **åŒä¸€æ—¶é—´æˆ³å¤šæ¡æ•°æ®è§¦å‘é‡å¤åˆ é™¤å¯¼è‡´è¯é¢‘å¼‚å¸¸**
```cpp
// é”™è¯¯ä»£ç 
else
{
    curr_time = timeSec;        // æ›´æ–°å½“å‰æ—¶é—´
    remove_outdate_words();     // æ¯æ¡å¼¹å¹•éƒ½åˆ é™¤ä¸€æ¬¡
}
```

   - **ç°è±¡**ï¼šç¨‹åºè¿è¡Œåï¼ŒåæœŸæŸ¥è¯¢çš„çƒ­è¯é¢‘ç‡éƒ½å˜æˆäº†1æ¬¡ï¼Œçƒ­è¯ç»Ÿè®¡å¤±æ•ˆ
   - **åŸå› **ï¼šå½“çª—å£æ»¡äº†ï¼ˆè¾¾åˆ°600ç§’ï¼‰åï¼ŒåŒä¸€æ—¶é—´æˆ³çš„å¤šæ¡å¼¹å¹•ä¼šé‡å¤è§¦å‘åˆ é™¤é€»è¾‘
   - **é—®é¢˜åˆ†æ**ï¼š
     - å‡è®¾ç¬¬600ç§’æœ‰100æ¡å¼¹å¹•ï¼ˆåŒä¸€æ—¶é—´æˆ³ï¼‰
     - ç¬¬1æ¡å¼¹å¹•ï¼š`timeSec = 600`ï¼Œ`curr_time` ä»599æ›´æ–°ä¸º600ï¼Œè°ƒç”¨ `remove_outdate_words()` åˆ é™¤ç¬¬0ç§’çš„æ‰€æœ‰è¯ 
     - ç¬¬2æ¡å¼¹å¹•ï¼š`timeSec = 600`ï¼Œä½† `curr_time` å·²ç»æ˜¯600ï¼Œ`cur_window_size >= max_window_size` ä»ç„¶æˆç«‹ï¼Œå†æ¬¡è¿›å…¥ `else` åˆ†æ”¯
     - åˆè°ƒç”¨ `remove_outdate_words()`ï¼Œè¿™æ¬¡åˆ é™¤ç¬¬1ç§’çš„æ‰€æœ‰è¯
     - ç¬¬3-100æ¡å¼¹å¹•ï¼šç»§ç»­åˆ é™¤ç¬¬2ç§’ã€ç¬¬3ç§’...çš„è¯
     - ç»“æœï¼šçª—å£è¢«ç–¯ç‹‚ç¼©å°ï¼Œå¤§é‡é«˜é¢‘è¯è¢«è¯¯åˆ ï¼Œå¯¼è‡´å‰©ä½™è¯é¢‘ç‡éƒ½å˜æˆ1
   - **è§£å†³æ–¹æ¡ˆ**ï¼šåªåœ¨æ—¶é—´æˆ³å˜åŒ–æ—¶è§¦å‘åˆ é™¤æ“ä½œ

```cpp
// ä¿®æ­£åä»£ç 
if (cur_window_size < max_window_size)
{
    if (curr_time != timeSec)
    {
        curr_time = timeSec;
        ++cur_window_size;
    }
}
else
{
    if (curr_time != timeSec)  // å¢åŠ æ—¶é—´æˆ³å˜åŒ–åˆ¤æ–­
    {
        curr_time = timeSec;
        remove_outdate_words();
    }
}
```

## v0.2 è§„èŒƒåŒ–å‘½åï¼Œå¼•å…¥ Xmake æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæ”¯æŒåŸºæœ¬ CLI 
### äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘é€‰ Xmake
`xmake.lua`ï¼š
```lua
add_rules("mode.debug", "mode.release")


target("yatha")
    set_kind("binary")
    add_files("src/*.cpp")

    add_includedirs("include")
    add_includedirs("third_party/cppjieba")

    set_targetdir("bin")
    set_rundir("$(projectdir)")
    set_runargs("input1.txt", "output.txt")
    
    if is_plat("linux", "macosx") then 
        add_syslinks("pthread", "m")
    end
```
å®ŒæˆåŒç­‰åŠŸèƒ½æ‰€éœ€çš„ `CmakeLists.txt`:
```cmake
cmake_minimum_required(VERSION 3.10)

project(yatha CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)


set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)


file(GLOB SOURCES "src/*.cpp")


add_executable(yatha ${SOURCES})

target_include_directories(yatha PRIVATE
    include
    third_party/cppjieba
)

if(UNIX OR APPLE)
    # æŸ¥æ‰¾çº¿ç¨‹åº“ (æ¯”ç›´æ¥å†™ "pthread" æ›´è§„èŒƒ)
    set(THREADS_PREFER_PTHREAD_FLAG ON)
    find_package(Threads REQUIRED)

    target_link_libraries(yatha PRIVATE
        Threads::Threads 
        m               
    )
endif()

add_custom_target(run
    COMMAND yatha input1.txt output.txt
    WORKING_DIRECTORY ${CMAKE_SOURCE_DIR} # å¯¹åº” set_rundir("$(projectdir)")
    DEPENDS yatha
    COMMENT "Running yatha with default arguments..."
)
```
1. **å¯è¯»æ€§å¼º**
lua æ˜¯ä¸€é—¨è„šæœ¬è¯­è¨€ï¼Œè¯­æ³•ç®€æ´ç›´è§‚æ¯”èµ· `CmakeLists.txt` ä¸­ä¸€ä¼šå¤§å†™ä¸€ä¼šå°å†™ï¼Œå„ç§ä½•æ„å‘³çš„å®å®šä¹‰ï¼Œxmake çš„è¯­æ³•ç»å¯¹æ˜¯**å°è‘±æ‹Œè±†è…â€”â€”ä¸€æ¸…äºŒç™½äº†**
2. **æ„å»ºæµç¨‹ç®€å•**
Cmake é€šå¸¸éœ€è¦
```shell
mkdir build 
cd build
cmake ..
make
```
è¿™ä¸€å¥—ç¹ççš„æµç¨‹æ‰èƒ½å¼€å§‹æ„å»ºé¡¹ç›®

ä½†æ˜¯å¯¹äº xmakeï¼Œåªè¦å†™å¥½é…ç½®æ–‡ä»¶`xmake.lua`ï¼ˆå¦‚ä¸Šé¢æ‰€ç¤ºï¼Œå¹¶ä¸ç¹çï¼‰ä¸ç®¡åœ¨é¡¹ç›®çš„å“ªä¸€ä¸ªç›®å½•ï¼Œæ„å»ºé¡¹ç›®åªéœ€æ‰§è¡Œ`xmake`ï¼Œè¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶åªéœ€`xmake run`ï¼ˆè‹¥ä»»ä½•ä¾èµ–æ–‡ä»¶æœ‰æ›´æ–°ä¼šé‡æ–°æ„å»ºï¼‰~~å¯¹äºæ­£åœ¨ç„¦å¤´çƒ‚é¢èµ¶å¤§ä½œä¸š DDL çš„æˆ‘æ¥è¯´è¿™ç¡®å®æ˜¯ make my life easieräº†~~

### Windowsä¸‹ä½¿ç”¨ Xmake é‡åˆ°çš„ç¼–ç é—®é¢˜
![alt text](/img/image.png)
æŸ¥é˜…èµ„æ–™å¯çŸ¥ï¼šWindows é»˜è®¤ä»£ç é¡µï¼ˆæ“ä½œç³»ç»Ÿä¸­ç”¨äºè¡¨ç¤ºæ–‡æœ¬æ–‡ä»¶ä¸­å­—ç¬¦çš„ç¼–ç ï¼‰é€šå¸¸æ˜¯ GBKï¼Œè¿™æ—¶éœ€è¦ä¸º MSVC æŒ‡å®š `/utf8` å‚æ•°
```lua
if is_plat("windows") then 
        add_cxflags("/utf-8", {tools = "cl"})
        add_cxflags("-finput-charset=UTF-8", "-fexec-charset=UTF-8", {tools = {"gcc", "clang"}})
end
```

### æ‰©å±•å‘½ä»¤è¡Œå‚æ•°é€‰é¡¹ï¼Œå®ç°è¯æ€§ç­›é€‰åŠŸèƒ½
#### 1. **å‘ç° cppjieba åº“çš„ä½œè€…åœ¨ `limonp` æ–‡ä»¶å¤¹ä¸­å·å·å®ç°äº†å¾ˆå¤šå¾ˆå¥½ç”¨çš„å·¥å…·å‡½æ•°**

æ¯”å¦‚ `ArgvContext.hpp` å°±æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†å‘½ä»¤è¡Œå‚æ•°çš„ç±»

è¯¥ç±»çš„æ„é€ å‡½æ•°ï¼š
```cpp
ArgvContext(int argc, const char* const * argv) {
    for(int i = 0; i < argc; i++) {
      if(StartsWith(argv[i], "-")) {
        if(i + 1 < argc && !StartsWith(argv[i + 1], "-")) {
          mpss_[argv[i]] = argv[i+1];
          i++;
        } else {
          sset_.insert(argv[i]);
        }
      } else {
        args_.push_back(argv[i]);
      }
    }
}
```
äºæ˜¯åœ¨è¯¥ç±»ä¸­æ·»åŠ ä¸€ä¸ª`public`å‡½æ•°`ReadArgv()`å®ç°å‘½ä»¤è¡Œå‚æ•°çš„è¯»å–
```cpp
void ReadArgv(std::string& Input, std::string& Output, int& Windows, int& TopK, std::unordered_set<std::string>& ftr, std::unordered_set<std::string>& csr)
  {
    if(this->HasKey("-h"))
    {
      PrintHelp();
      exit(0);
    }
    if(this->HasKey("-wc"))
    {
      PrintPOSHelp();
      exit(0);
    }
    if(this->HasKey("-i"))
    {
        Input = mpss_["-i"];
        if(args_[0] == ".\\yatha.exe")
          std::cout << "è¾“å…¥æ–‡ä»¶ï¼š" << "data\\" << Input << "\n";
        else
          std::cout << "è¾“å…¥æ–‡ä»¶ï¼š" << "data/" << Input << "\n";
    }
    else
    {
        std::cout << "è¯·æŒ‡å®šè¾“å…¥æ–‡ä»¶\n";
        exit(1);
    }
    if(this->HasKey("-o"))
    {
        Output = mpss_["-o"]; 
        if(args_[0] == ".\\yatha.exe")
          std::cout << "è¾“å‡ºæ–‡ä»¶ï¼š" << "data\\" << Output << "\n";
        else
          std::cout << "è¾“å‡ºæ–‡ä»¶ï¼š" << "data/" << Output << "\n";
    }
    else
    {
        std::cout << "è¯·æŒ‡å®šè¾“å‡ºæ–‡ä»¶\n";
        exit(1);
    }
    if(this->HasKey("-t"))
    {
      Windows = std::stoi(mpss_["-t"]);
      std::cout << "æ—¶é—´çª—å£å¤§å°ï¼š" << Windows << "s\n";
    }
    if(this->HasKey("-k"))
    {
      TopK = std::stoi(mpss_["-k"]);
      std::cout << "TopK: " << TopK << "\n";
    }
  }
```
#### 2. æŸ¥é˜…cppjiebaåº“èµ„æ–™å¾—åˆ°è¯æ€§å¯¹ç…§è¡¨ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥æ¥é€‰æ‹©**è¿‡æ»¤/æ”¾è¡Œ**å±äºæŸç§è¯æ€§çš„è¯è¯­
ï¼ˆæ•æ„Ÿè¯è¿‡æ»¤åŠŸèƒ½å› ä¸ºæµ‹è¯•æ–‡æœ¬**ä¸æ–¹ä¾¿**ç”Ÿæˆï¼Œæ‰€ä»¥æ”¹åšè¯æ€§ç­›é€‰ï¼‰
ç”±äºcppjiebaåº“æœ¬èº«å®ç°å¯¹æŸäº›è¯è¯­çš„è¯†åˆ«å°±ä¸å¤ªå‡†ç¡®ï¼Œå¦‚â€œåˆ˜å¤‡â€ç«Ÿç„¶è¢«å½’ä¸ºéŸ³è¯‘äººåæ‰€ä»¥**æ˜¯å¦ç²¾å‡†åœ°ç­›é€‰/æ”¾è¡ŒæŸç±»è¯æ€§çš„è¯è¯­ä¸åœ¨è€ƒè™‘èŒƒå›´å†…**ï¼Œè¿™é‡Œåªæ³¨é‡ç®—æ³•è®¾è®¡

åœ¨ `HaEngin` ç±»é‡Œåˆ†åˆ«ç»´æŠ¤æ— åºé›† `filter`, `chooser` ç”¨æ¥ç¡®å®šéœ€è¦è¿‡æ»¤/æ”¾è¡Œçš„è¯æ€§ï¼Œå†å¯¹åŸæ¥çš„ `cutWords()`å‡½æ•°ç¨åŠ ä¿®æ”¹å³å¯å®ç°åŠŸèƒ½

## v0.3 å®ç°è¯æ€§è¿‡æ»¤/æ”¾è¡ŒåŠŸèƒ½
åœ¨ `HaEngine` ç±»ä¸­å¢åŠ äº† `cutWordFilter` å’Œ `cutWordChooser` ä¸¤ä¸ªæˆå‘˜å‡½æ•°
- **åŸç†**ï¼š
  ä½¿ç”¨ `jieba.Tag()` æ›¿ä»£æ™®é€šçš„ `jieba.Cut()`ï¼Œè¿™æ ·åˆ†è¯ç»“æœä¼šåŒ…å«è¯æ€§ä¿¡æ¯ï¼ˆå¦‚ `n` è¡¨ç¤ºåè¯ï¼Œ`v` è¡¨ç¤ºåŠ¨è¯ï¼‰
- **å®ç°é€»è¾‘**ï¼š
  - `cutWordFilter`ï¼šéå†åˆ†è¯ç»“æœï¼Œå¦‚æœæŸè¯çš„è¯æ€§**ä¸åœ¨** `filter` é›†åˆä¸­ï¼Œä¸”ä¸æ˜¯åœç”¨è¯ï¼Œåˆ™ç»Ÿè®¡è¯¥è¯
  - `cutWordChooser`ï¼šéå†åˆ†è¯ç»“æœï¼Œå¦‚æœæŸè¯çš„è¯æ€§**åœ¨** `chooser` é›†åˆä¸­ï¼Œä¸”ä¸æ˜¯åœç”¨è¯ï¼Œåˆ™ç»Ÿè®¡è¯¥è¯

```cpp
if (!swManager.isStopWord(wordWithCls[i].first) && filter.find(wordWithCls[i].second) == filter.end())
{
    // åŠ å…¥ç»Ÿè®¡...
}
```
**åŒæ—¶å¢æ·»å‘½ä»¤è¡Œå‚æ•°é€‰é¡¹ `-wc`ï¼Œæ‰“å°è¯æ€§æ ‡è¯†ç¬¦å¯¹åº”çš„è¯æ€§ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œé€‰æ‹©**


## v0.7 å®ç° Web GUI ç•Œé¢
ä½¿ç”¨ä¸€ä¸ªè½»é‡çº§çš„ C++ HTTP åº“ `cpp-httplib` æ¥æ­å»º Web æœåŠ¡å™¨ï¼ˆå¼•ç”¨ä¸€ä¸ªå¤´æ–‡ä»¶å°±èƒ½å¯åŠ¨æœåŠ¡å™¨ï¼Œéå¸¸æ–¹ä¾¿ï¼‰ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ª Web GUI ç•Œé¢ã€‚

### 1. åç«¯å®ç°
- **é›†æˆ httplib**ï¼šåœ¨ `yatha.cpp` ä¸­å¼•å…¥ `httplib.h`
- **æ–°å¢æœåŠ¡å™¨æ¨¡å¼**ï¼š
  - ä¿®æ”¹ `ArgvContext` ç±»ï¼Œå¢åŠ  `-s` å‚æ•°è§£æï¼Œç”¨æ¥å¯åŠ¨ HTTP æœåŠ¡å™¨
  - å½“ç”¨æˆ·è¾“å…¥ `./yatha -s` æ—¶ï¼Œå¯åŠ¨ HTTP æœåŠ¡å™¨ç›‘å¬ 8080 ç«¯å£
- **API è®¾è®¡**ï¼š
  - æä¾› `/api/analyze` POST æ¥å£
  - æ¥æ”¶å‰ç«¯ä¸Šä¼ çš„æ–‡æœ¬å†…å®¹ï¼Œå†™å…¥ä¸´æ—¶æ–‡ä»¶ `temp_input.txt`
  - åˆ©ç”¨ cpp çš„ RAII æœºåˆ¶æ§åˆ¶ `HaEngine` ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿ç»“æœå†™å…¥ç£ç›˜åå†è¯»å–è¿”å›

```cpp
// RAII ç¡®ä¿æ–‡ä»¶æµæ­£ç¡®å…³é—­
{
    HaEngine ha(..., tempInput, tempOutput);
    ha.cutWord();
} // ha ç¦»å¼€åŸŸï¼Œè‡ªåŠ¨ææ„ï¼Œç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­å¹¶ä¿å­˜
```

### 2. å‰ç«¯å®ç°
- **ç•Œé¢è®¾è®¡**ï¼šåˆ›å»ºä¸€ä¸ªç®€æ´çš„ HTML é¡µé¢ï¼ŒåŒ…å«æ–‡ä»¶ä¸Šä¼ åŒºåŸŸï¼Œé¡ºä¾¿ç»™å®éªŒå®¤æ‰“ä¸€ä¸ªå°å°çš„å¹¿å‘ŠğŸ¤­
- **äº¤äº’é€»è¾‘**ï¼š
  - æ”¯æŒç‚¹å‡»ä¸Šä¼ å’Œæ‹–æ‹½ä¸Šä¼  `.txt` æ–‡ä»¶
  - ä½¿ç”¨ `fetch` API å°†æ–‡ä»¶å†…å®¹å‘é€ç»™åç«¯
  - æ”¶åˆ°å“åº”åå®æ—¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçƒ­è¯åˆ†æç»“æœï¼Œæ— éœ€é¡µé¢è·³è½¬

### 3. é‡åˆ°çš„å‘ä¸è§£å†³æ–¹æ¡ˆ
- **é—®é¢˜1ï¼šç½‘é¡µç«¯åˆ†æç»“æœæ˜¾ç¤ºä¸ºç©º**
  - åŸå› ï¼š`HaEngine` è¿˜åœ¨è¿è¡Œï¼ˆæ–‡ä»¶æµæœªå…³é—­ï¼‰æ—¶å°±å°è¯•è¯»å–è¾“å‡ºæ–‡ä»¶ï¼Œå¯¼è‡´è¯»åˆ°ç©ºå†…å®¹
  - è§£å†³åŠæ³•ï¼šå°† `HaEngine` çš„å®ä¾‹åŒ–æ”¾å…¥ç‹¬ç«‹ä½œç”¨åŸŸ `{}` ä¸­ï¼Œå¼ºåˆ¶å…¶åœ¨è¯»å–å‰ææ„å¹¶åˆ·æ–°æ–‡ä»¶æµ
- **é—®é¢˜2ï¼šæ–‡ä»¶è¦†ç›–é£é™©**
  - åŸå› ï¼šæœ€åˆä½¿ç”¨ `input1.txt` ä½œä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå®¹æ˜“è¦†ç›–ç”¨æˆ·æ•°æ®
  - è§£å†³åŠæ³•ï¼šæ”¹ç”¨ `temp_input.txt` å’Œ `temp_output.txt`
- **é—®é¢˜3ï¼šæ–‡ä»¶æŒ‚è½½é—®é¢˜**
  - åŸå› ï¼šå‰ç«¯è®¿é—®é™æ€æ–‡ä»¶çš„è¯·æ±‚éœ€è¦å¤„ç†ä¹‹åè¿”å›
  å¦‚
  ```cpp
  svr.Get("/index.html", [](auto& req, auto& res){
    // 1. æ‰“å¼€ web/index.html
    // 2. è¯»å–å†…å®¹
    // 3. è®¾ç½® Content-Type ä¸º text/html
    // 4. å‘é€
  });

  svr.Get("/style.css", [](auto& req, auto& res){
    // 1. æ‰“å¼€ web/style.css
    // ... é‡å¤
  });
  ```

  - è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ `svr.set_mount_point()` å‡½æ•°ï¼Œä¸€è¡Œä»£ç å³å¯å®ç°é™æ€ç›®å½•çš„æŒ‚è½½ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†æ¯ä¸ªæ–‡ä»¶çš„è¯·æ±‚ã€‚
  ```cpp
    // Serve static files from web directory (assuming running from data/ directory)
    svr.set_mount_point("/", "../web");
    svr.set_mount_point("/img", "../img");
  ```
- **é—®é¢˜4ï¼šæ‹–æ”¾åŠŸèƒ½é»˜è®¤è¡Œä¸º**
  - åŸå› ï¼šæµè§ˆå™¨é»˜è®¤ä¼šå¯¹æŸä¸€äº›è¡Œä¸ºåšå¤„ç†ã€‚å¦‚æŠŠæ–‡æœ¬æ–‡ä»¶æ‹–è¿›æµè§ˆå™¨ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯æ‰“å¼€å¹¶æ˜¾ç¤ºã€‚
  - è§£å†³åŠæ³•ï¼š
  ```cpp
  e.preventDefault();
  ```
  è°ƒç”¨`preventDefault()`æ–¹æ³•é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚

## v0.8 ä»£ç é‡æ„
å½“æˆ‘å‡†å¤‡åœ¨Web GUI ä¸­æ–°å¢æ»šåŠ¨æŸ¥è¯¢åŠŸèƒ½çš„æ—¶å€™ï¼Œå‘ç° `HaEngine` éå¸¸è‡ƒè‚¿ï¼Œå‡ ä¹æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯åœ¨è¿™ä¸ªç±»ä¸­å®ç°çš„ã€‚ä¸ºäº†ä¿è¯ä»£ç çš„å¯è¯»æ€§å’Œå‡å°‘æœªæ¥ä¸å¿…è¦çš„è°ƒè¯•éº»çƒ¦ï¼ŒåŒæ—¶å‡å°‘ç¼–è¯‘~~åç‰¢~~æ—¶é—´ï¼ˆå¦‚æœå‡½æ•°éƒ½å®ç°åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡å°å˜åŠ¨éƒ½ä¼šå¯¼è‡´é¡¹ç›®ä¸»è¦æ–‡ä»¶çš„é‡æ–°ç¼–è¯‘ï¼Œä¼š**æå¤§åœ°æå‡ä¸å¹¸ç¦æ„Ÿ**ï¼Œå¤§ä½œä¸šè¦èµ¶ä¸å®Œäº†ï¼‰ï¼Œå†³å®šé‡æ„ä»£ç ï¼

### 1. åŸæ¥çš„ `HaEngine` ç±»ï¼š
```cpp
class HaEngine
{
    private:
        std::queue<Tword> historyQueue;                            // è®°å½•å½“å‰æ—¶é—´çª—å£çš„è¯è¯­
        std::unordered_map<std::string, int> freqMap;              // è®°å½•å½“å‰æ—¶é—´çª—å£è¯è¯­çš„é¢‘æ¬¡
        std::set<Tword> rankingSet;                                // æŒ‰è¯è¯­å‡ºç°é¢‘æ¬¡å‡åºæ’åˆ—é›†åˆ

        std::vector<std::string> lines;
        std::vector<Tword> words;
        StopWordsManager swManager;
        
        
        const std::string inputFile{};
        const std::string outputFile{}; 
        std::ofstream out;                                          // åœ¨æ„é€ å‡½æ•°ä¸­æ‰“å¼€æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ countTopKwordsä¸­æ‰“å¼€ï¼Œé¿å…å†…å®¹è¦†ç›–ï¼›
        int maxWindowSize{};                                      
        int currTime = -1;                                          // è¾“å…¥æ–‡ä»¶æ—¶é—´æˆ³ä»0ç§’å¼€å§‹ï¼Œåˆå§‹æ—¶é—´æˆ³è®¾ä¸º -1
        int curWindowSize{};
        int topK{};
        std::unordered_set<std::string> filter{};        
        std::unordered_set<std::string> chooser{};                   
        
        public:
        cppjieba::Jieba jieba;
        
        HaEngine(const std::string& dictPath, const std::string& hmmPath, const std::string& userDictPath, 
                 const std::string& idfPath, const std::string& stopWordDictPath, int window, int k, std::unordered_set<std::string>& ftr,
                 std::unordered_set<std::string>& chsr, const std::string &i, const std::string &o);
        void cutWordsTest();
        void cutWord();
        void cutWordFilter();
        void cutWordChooser();
        void writeOutput();
        bool readUtf8Lines(std::vector<std::string>& lines);
        void testOutput();
        void removeOutdatedWords();
        void countTopKWords(std::ofstream& out);

};
```
å¯ä»¥çœ‹åˆ°åŒ…æ‹¬1ï¼‰æ—¶é—´çª—å£ç®¡ç†ï¼Œ2ï¼‰TopK æ’è¡Œæ¦œç®¡ç†ç­‰åŠŸèƒ½çš„æœ‰å…³å˜é‡å’Œå‡½æ•°ç»Ÿç»ŸæŒ¤åœ¨äº†è¿™ä¸ªç±»é‡Œï¼Œçœ‹å¾—å¤´æ™•ã€‚

### 2. é‡æ„ä»£ç ï¼
`HaEngine` ä½œä¸ºæ€»è°ƒåº¦å™¨ï¼Œå°†åŸæ¥çš„æ—¶é—´çª—å£ç®¡ç†ã€TopKæ’è¡Œæ¦œç®¡ç†åˆ†åˆ«åˆ†ç¦»åˆ°`TimeWindowManager`ç±»å’Œ`WordRanker`ç±»ä¸­
```cpp
class WordRanker
{
    private:
        std::unordered_map<std::string, int> freqMap; // è¯é¢‘æ˜ å°„
        std::set<Tword> rankingSet;                   // æŒ‰é¢‘æ¬¡æ’åºçš„é›†åˆ (freq, word)

    public:
        WordRanker() = default;

        // æ·»åŠ ä¸€ä¸ªè¯ï¼ˆè¯é¢‘+1ï¼‰
        void addWord(const std::string &word);

        // ç§»é™¤ä¸€ä¸ªè¯ï¼ˆè¯é¢‘-1ï¼Œå¦‚æœä¸º0åˆ™å®Œå…¨åˆ é™¤ï¼‰
        void removeWord(const std::string &word);

        // è·å–TopKè¯æ±‡
        std::vector<std::pair<std::string, int>> getTopK(int k) const;

        // è·å–æ’åé›†åˆï¼ˆç”¨äºè¾“å‡ºæ ¼å¼åŒ–ï¼‰
        const std::set<Tword> &getRankingSet() const { return rankingSet; }
};
```

```cpp
class TimeWindowManager
{
    private:
        std::queue<Tword> historyQueue;  // å­˜å‚¨æ‰€æœ‰åœ¨çª—å£å†…çš„è¯
        int maxWindowSize;               // æœ€å¤§çª—å£å¤§å°
        int currTime = -1;               // å½“å‰æ—¶é—´æˆ³
        int curWindowSize = 0;           // å½“å‰çª—å£å¤§å°

    public:
        TimeWindowManager(int windowSize);
        
        // åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»é™¤è¿‡æœŸè¯
        bool shouldRemoveOld(int newTime);
        
        // è·å–å¹¶ç§»é™¤è¿‡æœŸçš„è¯ï¼ˆè¿”å›éœ€è¦åˆ é™¤çš„è¯åˆ—è¡¨ï¼‰
        std::vector<Tword> getAndRemoveOutdatedWords();
        
        // æ·»åŠ æ–°è¯åˆ°çª—å£
        void addWord(int timestamp, const std::string& word);
        
        // Getteræ–¹æ³•
        int getCurrentTime() const { return currTime; }
        int getCurrentWindowSize() const { return curWindowSize; }
        bool isEmpty() const { return historyQueue.empty(); }
};
```
é‡æ„ä¹‹åçš„å¥½å¤„ï¼š
1. **å•ä¸€èŒè´£**
æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹ï¼š`TimeWindowManager` ç®¡ç†æ—¶é—´çª—å£ï¼Œ`WordRanker` ç®¡ç†è¯é¢‘æ’åï¼Œ`HaEngine` è´Ÿè´£åè°ƒè°ƒåº¦ã€‚ä»£ç èŒè´£æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´å¼ºäº†ï¼Œæ˜“äºç»´æŠ¤

2. **é™ä½è€¦åˆåº¦**
å„æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ï¼Œæ¥å£æ˜ç¡®ã€‚ä¸”ä¿®æ”¹ä¸€ä¸ªæ¨¡å—çš„å†…éƒ¨å®ç°ä¸ä¼šå½±å“å…¶ä»–æ¨¡å—

3. **å‡å°‘ç¼–è¯‘æ—¶é—´**ï¼ˆä¸»è¦ï¼ï¼ï¼‰
å‡å¦‚æƒ³ä¿®æ”¹ `WordRanker` çš„å®ç°æ—¶ï¼Œåªéœ€é‡æ–°ç¼–è¯‘ `word_ranker.cpp` åŠä¾èµ–å®ƒçš„æ–‡ä»¶ï¼Œè€Œä¸ä¼šè§¦å‘æ•´ä¸ªé¡¹ç›®çš„é‡æ–°ç¼–è¯‘ï¼ŒèŠ‚çœæ—¶é—´ï¼ˆå¤©ç”Ÿæ‰“å·¥åœ£ä½“ï¼Œå¤ªå¥½äº†å‰©ä½™ä»·å€¼åˆèƒ½è¢«å……åˆ†å‹æ¦¨äº†ï¼‰

4. **ä¾¿äºåŠŸèƒ½æ‰©å±•**

## v1.0 å°†è¯æ€§è¿‡æ»¤/æ”¾è¡ŒåŠŸèƒ½æ•´åˆå…¥ Web GUI ç•Œé¢
### 1. æä¾›ä¸¤ä¸ªæ–°çš„æ¥å£ `/api/analyze-filter` å’Œ `/api/analyzer-chooser`
å› ä¸ºåŸæ¥å·²ç»å®ç°äº† `cutWordFiter()` å’Œ `cutWordChooser()` å‡½æ•°ï¼Œæ‰€ä»¥åªéœ€è¦æä¾›ä¸¤ä¸ªæ–°çš„æ¥å£ä¾›å‰ç«¯è¯·æ±‚å³å¯ã€‚
```cpp
svr.Post("/api/analyze-filter", [](const httplib::Request &req, httplib::Response &res{}));
svr.Post("/api/analyze-chooser", [](const httplib::Request &req, httplib::Response &res){});
```

### 2. å‰ç«¯æ–°å¢ä¸€ä¸ªè¯æ€§é€‰æ‹©è¡¨ï¼Œä¸ºç”¨æˆ·æä¾›è¯æ€§è¿‡æ»¤/æ”¾è¡ŒåŠŸèƒ½
![](/img/fiter.png)
å‰ç«¯ä¼šæ ¹æ®æ‰€é€‰æ¨¡å¼æ¥è¯·æ±‚ä¸åŒçš„æ¥å£ï¼š
```cpp
// æ ¹æ®æ¨¡å¼é€‰æ‹©APIç«¯ç‚¹
let apiUrl = '/api/analyze';
if (posConfig.mode === 'filter' && posConfig.pos.length > 0) {
    apiUrl = '/api/analyze-filter';
} else if (posConfig.mode === 'allow' && posConfig.pos.length > 0) {
    apiUrl = '/api/analyze-chooser';
}

// å‡†å¤‡è¯·æ±‚ä½“
const fileContent = await file.text();

let response;
if(apiUrl === '/api/analyze')
{
    response = await fetch(apiUrl, 
    {
        method: 'POST',
        headers: 
        {
            'Content-Type': 'text/plain' 
        },
        body: fileContent
    });
}
else
{
    response = await fetch(apiUrl,
    {
        method: 'POST',
        headers:
        {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            content: fileContent,
            pos: posConfig.pos.join(',')
        })
    });
}
```
### é‡åˆ°çš„é—®é¢˜
#### 1. JSON æ–‡ä»¶æ ¼å¼å¤„ç†é—®é¢˜
`/api/analyzer-...`
```cpp
// 1. æå– content å­—æ®µ
size_t contentStart = jsonBody.find("\"content\":\"") + 12;
size_t contentEnd = jsonBody.find("\"", contentStart);
std::string inputContent = jsonBody.substr(contentStart, contentEnd - contentStart);

// 2. æå– pos å­—æ®µ
size_t posStart = jsonBody.find("\"pos\":\"") + 7;
size_t posEnd = jsonBody.find("\"", posStart);
std::string posString = jsonBody.substr(posStart, posEnd - posStart);
```
å‘ç°å‰ç«¯æ— æ³•åˆ†æï¼Œåªæç¤ºï¼š[xxæ¨¡å¼ï¼šxx]
æŸ¥çœ‹ç”Ÿæˆçš„`temp_chooser_output.txt`æ–‡ä»¶ï¼Œå‘ç°åŸå› å‡ºåœ¨æ²¡æœ‰æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²ä¸­çš„æ¢è¡Œç¬¦`\n`ï¼›

è§£å†³åŠæ³•ï¼š
```cpp
std::string inputContent;
for (size_t i = contentStart; i < jsonBody.length(); i++) {
    if (jsonBody[i] == '\\' && i + 1 < jsonBody.length()) 
    {
        if (jsonBody[i + 1] == 'n') { inputContent += '\n'; i++; }
        else if (jsonBody[i + 1] == 't') { inputContent += '\t'; i++; }
        else if (jsonBody[i + 1] == '\"') { inputContent += '\"'; i++; }
        else if (jsonBody[i + 1] == '\\') { inputContent += '\\'; i++; }
        else inputContent += jsonBody[i];
    } 
    else if (jsonBody[i] == '\"' && (i == 0 || jsonBody[i-1] != '\\')) 
        break; // æ‰¾åˆ°contentå­—æ®µçš„ç»“æŸå¼•å·
    else 
        inputContent += jsonBody[i];
}
```
å»ºç«‹ä¸€ä¸ªå¾ªç¯æ¥æ­£ç¡®å¤„ç† JSON æ•°æ®ä¸­çš„æ¢è¡Œç¬¦ã€‚

##### åæ€ï¼š
ä¸è¿‡æ»¤æ¨¡å¼ä¸‹ï¼Œåªéœ€è¦è¿”å›æ–‡æœ¬å³å¯ï¼Œæ ¼å¼æ˜¯`text/plain`ï¼Œè¿™æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œä¸éœ€è¦å¤„ç†æ¢è¡Œç¬¦ã€‚ä½†æ˜¯å¯¹äº JSON å­—ç¬¦ä¸²ï¼Œå°±éœ€è¦å¤„ç†æ¢è¡Œç¬¦äº†ã€‚

#### 2. ä¸è¿‡æ»¤æ¨¡å¼ä¸‹æ— æ³•æ­£å¸¸åˆ†ææ–‡æœ¬
æ£€æŸ¥`index.html`å‘ç°ï¼Œä¸è®ºæ˜¯è¿‡æ»¤/æ”¾è¡Œæ¨¡å¼è¿˜æ˜¯ä¸è¿‡æ»¤æ¨¡å¼ï¼Œhttpè¯·æ±‚å¤´çš„bodyéƒ½å˜æˆäº† JSON å­—ç¬¦ä¸²
```cpp
response = await fetch(apiUrl,
          {
              method: 'POST',
              headers:
              {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                  content: fileContent,
                  pos: posConfig.pos.join(',')
              })
          });
```
è§£å†³åŠæ³•ï¼šæ·»åŠ ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œè‹¥æ˜¯ä¸è¿‡æ»¤æ¨¡å¼ï¼Œåˆ™bodyä¸º`text/plain`ï¼Œå¦åˆ™ä¸º`application/json`
```cpp
let response;
if(apiUrl === '/api/analyze')
{
    response = await fetch(apiUrl, 
    {
        method: 'POST',
        headers: 
        {
            'Content-Type': 'text/plain' 
        },
        body: fileContent
    });
}
else
{
    response = await fetch(apiUrl,
    {
        method: 'POST',
        headers:
        {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            content: fileContent,
            pos: posConfig.pos.join(',')
        })
    });
}
```

## v1.1 å¼•å…¥ nlohmann/json åº“ï¼Œä»æ­¤ä¸ç”¨æ‰‹æ“ JSON å­—ç¬¦ä¸²è§£æ
ï¼ˆä¹‹å‰æ‰‹æ“çš„ç™½å†™äº†â€¦â€¦this is lifeï¼‰
```cpp
std::string inputContent;
for (size_t i = contentStart; i < jsonBody.length(); i++) {
    if (jsonBody[i] == '\\' && i + 1 < jsonBody.length()) 
    {
        if (jsonBody[i + 1] == 'n') { inputContent += '\n'; i++; }
        else if (jsonBody[i + 1] == 't') { inputContent += '\t'; i++; }
        else if (jsonBody[i + 1] == '\"') { inputContent += '\"'; i++; }
        else if (jsonBody[i + 1] == '\\') { inputContent += '\\'; i++; }
        else inputContent += jsonBody[i];
    } 
    else if (jsonBody[i] == '\"' && (i == 0 || jsonBody[i-1] != '\\')) 
        break; // æ‰¾åˆ°contentå­—æ®µçš„ç»“æŸå¼•å·
    else 
        inputContent += jsonBody[i];
}
```

å› ä¸ºåç»­æ‰“ç®—å®ç°çš„**æ»šåŠ¨æŸ¥è¯¢**åŠŸèƒ½æ‰“ç®—é€šè¿‡é¢„å¤„ç†æ¯ä¸€ç§’çš„ TopK æ¥å®ç°ï¼ˆç”Ÿæˆæ¯ä¸€ç§’TopKçš„JSONæ–‡ä»¶ï¼‰ï¼Œæ‰€ä»¥æ‰“ç®—æå‰å¼•å…¥æ–¹ä¾¿å¥½ç”¨çš„ JSON åº“ã€‚

ä¸Šç½‘æŸ¥é˜…èµ„æ–™åå‘ç° nlohmann/json åº“å¹¿å—å¥½è¯„ï¼Œå®ƒå¯ä»¥ï¼š
1. è¯­æ³•ç›´è§‚ï¼Œå¯è¯»æ€§å¼º
```cpp
json j = {
  {"pi", 3.141},
  {"list", {1, 0, 2}},
  {"object", {{"currency", "USD"}, {"value", 42.99}}}
};
```
2. åªéœ€å¼•å…¥ä¸€ä¸ªå¤´æ–‡ä»¶`json.hpp`ï¼ˆä¸`httplib.h`ä¸€æ ·ï¼‰

3. ä¸ STL å®¹å™¨é›†æˆåº¦é«˜
```cpp
std::unordered_set<std::string> filter;
if(j.contains("pos"))
    filter = j["pos"].get<std::unordered_set<std::string>>();
```
å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°±å°† JSON æ•°ç»„è½¬æ¢æˆ STL å®¹å™¨

å°†åŸæ¥ JSON å­—ç¬¦ä¸²å¤„ç†ç”¨ `json.hpp` æä¾›çš„æ–¹æ³•é‡å†™
```cpp
json j = json::parse(req.body);
std::string inputContent;
if(j.contains("content"))
    inputContent = j["content"];
else
{
    res.set_content("JSONæ•°æ®æœªæä¾›\"content\"å­—æ®µ", "text/plain");
    return;
}
std::unordered_set<std::string> filter;
if(j.contains("pos"))
    filter = j["pos"].get<std::unordered_set<std::string>>();
else
{
    res.set_content("JSONæ•°æ®æœªæä¾›\"pos\"å­—æ®µ", "text/plain");
    return;
}
```
**ä»£ç ç®€æ´äº†å¾ˆå¤šï¼Œä¸”å¯è¯»æ€§æ›´å¼ºäº†**

## v1.7 Web GUI å¢åŠ æ»šåŠ¨æŸ¥è¯¢åŠŸèƒ½
è®¾è®¡æ„æƒ³ï¼šå®ç°ä¸€ä¸ªæ»šåŠ¨æŸ¥è¯¢åŠŸèƒ½â€”â€”ç”¨æˆ·å¯ä»¥åœ¨ä¸Šä¼ æ–‡ä»¶ä¹‹åï¼Œè®¾å®šæ‰€éœ€è¦çš„**æ—¶é—´çª—å£é•¿åº¦**ã€**TopK**å’Œ**æ­¥è¿›é•¿åº¦**ï¼ŒåŒæ—¶å¯ä»¥æ˜¾ç¤ºå‰ K ä¸ªçƒ­ç‚¹è¯æ±‡çš„æŸ±çŠ¶å›¾å’Œè¯äº‘å›¾ã€‚
### 1. æŠ€æœ¯è·¯çº¿çš„é€‰æ‹©
ä¸å¤§æ¨¡å‹æ²Ÿé€šä¹‹åå¾—çŸ¥ï¼Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½æœ‰ä¸‰ç§æŠ€æœ¯æ–¹æ¡ˆï¼š

    - åç«¯é¢„å¤„ç†ï¼Œå‰ç«¯è½®è¯¢
      1. åç«¯å…ˆå¤„ç†æ¯ `step` ç§’ï¼ˆ`step`ä¸ºæ­¥è¿›é•¿åº¦ï¼Œç”±ç”¨æˆ·è®¾ç½®ï¼‰çš„æ•°æ®ç”Ÿæˆ JSON æ–‡ä»¶ï¼Œå‰ç«¯æŒ‰éœ€è½®è¯¢è¿™äº›æ–‡ä»¶ã€‚
      è¿™ç§æ–¹æ³•**æœ€ç®€å•**ä½†æ˜¯æœ‰è¾ƒé«˜çš„æ€§èƒ½ç“¶é¢ˆï¼Œå› ä¸ºæ¯ `step` ç§’åç«¯éƒ½éœ€è¦å¤„ç†ä¸€æ¬¡ï¼Œå¤ªå¤æ‚ã€‚
    
    - SSE (Server-Sent Events)
      1. åç«¯å®æ—¶æ¨é€æ•°æ®æµï¼Œå‰ç«¯é€šè¿‡ `EventSource` æ¥æ”¶æœåŠ¡å™¨æ¨é€çš„æ•°æ®ã€‚
      è¿™ç§æ–¹æ³•**å•å‘é€šä¿¡**ï¼Œé€‚åˆæœåŠ¡å™¨ä¸»åŠ¨æ¨é€åœºæ™¯ï¼Œå®ç°ç›¸å¯¹ç®€å•ï¼Œä½†è¿æ¥å•å‘ï¼Œå‰ç«¯æ— æ³•ä¸»åŠ¨è¯·æ±‚ç‰¹å®šæ—¶é—´æ®µæ•°æ®ã€‚
    
    - WebSocket
      1. å»ºç«‹åŒå‘é€šä¿¡é€šé“ï¼Œå‰ç«¯å¯ä»¥éšæ—¶è¯·æ±‚ç‰¹å®šæ—¶é—´æ®µçš„æ•°æ®ï¼Œåç«¯å®æ—¶å“åº”ã€‚
      è¿™ç§æ–¹æ³•**æœ€çµæ´»**ï¼Œæ”¯æŒåŒå‘é€šä¿¡ï¼Œä½†å®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç»´æŠ¤è¿æ¥çŠ¶æ€ã€‚

æœ€åé€‰æ‹©äº† SSE æ–¹æ³•ï¼Œå› ä¸ºæ»šåŠ¨æŸ¥è¯¢æ˜¯**å•å‘æ•°æ®æµ**åœºæ™¯ï¼ŒæœåŠ¡å™¨æŒ‰æ—¶é—´é¡ºåºæ¨é€å³å¯ï¼Œæ— éœ€åŒå‘äº¤äº’ã€‚ä¸” `httplib` åº“åŸç”Ÿæ”¯æŒ SSEï¼Œå®ç°ç®€å•ï¼Œå‰ç«¯åªéœ€ä¸€ä¸ª `EventSource` å¯¹è±¡å³å¯æ¥æ”¶æ•°æ®æµï¼Œé¿å…äº† WebSocket çš„çŠ¶æ€ç®¡ç†å¤æ‚åº¦ã€‚

### 2. åç«¯ä»£ç çš„æ‰©å±•
æ–°å¢ä¸€ä¸ª`HaEngine`çš„å­ç±»`HaEngineSSE`ä¸º SSE åšé€‚é…
```cpp
class HaEngineSSE: public HaEngine
{
    private:
        int step;
        int lineIndex{};            // æ°¸è¿œæŒ‡å‘éœ€è¦è¯»å–çš„è¡Œ
    public:
        HaEngineSSE(const std::string& dictPath, const std::string& hmmPath, const std::string& userDictPath, 
                    const std::string& idfPath, const std::string& stopWordDictPath, int window, int k, std::unordered_set<std::string>& ftr,
                    std::unordered_set<std::string>& chsr, const std::string &i, const std::string &o, int step);
        bool cutWord() override;
        void countTopKWords(std::ofstream& out) override;
        bool cutWordFilter() override;
        bool cutWordChooser() override;

        // æœ¬æ¥æƒ³å®ç°å®æ—¶æ›´æ–°è¿™ä¸¤ä¸ªå‚æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äº SSE åªèƒ½ç”±åç«¯å‘å‰ç«¯å•å‘æ¨é€æ•°æ®ä½œç½¢
        // void updateStep(int newStep) { step = newStep; }
        // void updateTopK(int newTopK) { topK = newTopK; }
};
```
`step`å’Œ`lineIndex`åˆ†åˆ«ç”¨æ¥è®°å½•æ­¥è¿›é•¿åº¦ï¼ˆæ¯ä¸€æ¬¡è¯»å–å¤šå°‘ç§’çš„æ•°æ®ï¼‰å’Œè¿½è¸ªè¡Œæ•°ã€‚
```cpp
HaEngineSSE::HaEngineSSE
(
    const std::string &dictPath, const std::string &hmmPath, const std::string &userDictPath,
    const std::string &idfPath, const std::string &stopWordDictPath, int window, int k, std::unordered_set<std::string> &ftr,
    std::unordered_set<std::string> &csr, const std::string &i, const std::string &o, int step
) : 
HaEngine(dictPath, hmmPath, userDictPath, idfPath, stopWordDictPath, window, k, ftr, csr, i, o), step(step)
{
    // è¯»å–æ–‡ä»¶å†…å®¹åˆ°linesæˆå‘˜å˜é‡
    if (!readUtf8Lines(lines)) {
        std::cerr << "[é”™è¯¯] æ— æ³•è¯»å–è¾“å…¥æ–‡ä»¶: " << inputFile << std::endl;
        exit(1);
    }
    std::cout << "[HaEngineSSE] å·²è¯»å– " << lines.size() << " è¡Œæ•°æ®" << std::endl;
}
```
1. ç±»æ„é€ å‡½æ•°ä¼šå…ˆå°†æ•°æ®åˆ†è¡Œï¼Œå­˜æ”¾è¿›çˆ¶ç±»çš„ `lines` ä¸­ã€‚
2. æ„é€ å‡½æ•°å…ˆä¸æ‰“å¼€è¾“å‡ºæ–‡ä»¶ï¼Œå› ä¸ºè¾“å‡ºæ–‡ä»¶æ¯ä¸€æ¬¡éƒ½éœ€è¦è¦†ç›–è€Œä¸æ˜¯è¿½åŠ ï¼Œé€‰æ‹©åœ¨æ¯ä¸€æ¬¡è°ƒç”¨`countTopKWords()`æ—¶æ‰“å¼€ã€‚
3. å°† `cutWord()` ç­‰åˆ†è¯å‡½æ•°æ”¹æˆè¿”å› `bool` å€¼ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å·²ç»è¯»å–å®Œ `lines` ä¸­çš„æ•°æ®ã€‚é‡å†™åŸºç±»å‡½æ•°ï¼ŒæŒ‰æ­¥è¿›é•¿åº¦`step`è¯»å–`lines`ä¸­çš„æ•°æ®ã€‚
å…¶å®ƒç®—æ³•åŸºæœ¬ä¿æŒä¸€è‡´ã€‚

### 2. æœåŠ¡å™¨ API ç«¯å£çš„æš´éœ²
åœ¨`runWebServer()`å‡½æ•°ä¸­æš´éœ²äº†ä¸€ä¸ª`/api/stream-analyze`æ¥å£ï¼Œç”¨æ¥å°†åç«¯ç”Ÿæˆçš„æ•°æ®ç»„è£…æˆ SSE ä¿¡æ¯æŒç»­æ¨é€ç»™å‰ç«¯ã€‚ï¼ˆè¿˜å¥½ä¹‹å‰å¼•å…¥äº† JSON åº“ï¼Œä¸ç„¶è¿™ä¼šå¤„ç† JSON å­—ç¬¦ä¸²å°±æ˜¯æ¬èµ·çŸ³å¤´ç ¸è‡ªå·±çš„è„šï¼‰

### 3. è®¾è®¡è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜
#### 1. **æ–‡ä»¶å†™å…¥å’Œè¯»å–çš„æ—¶åºé—®é¢˜**
   - ç°è±¡ï¼šSSE æ¨é€çš„æ•°æ®æ—¶å¸¸ä¸ºç©ºæˆ–è€…è¯»å–åˆ°ä¸Šä¸€æ¬¡çš„æ—§æ•°æ®
   - åŸå› ï¼š`countTopKWords()` ä¸­ä½¿ç”¨æˆå‘˜å˜é‡ `out` å†™å…¥æ–‡ä»¶ï¼Œä½†æµæœªåŠæ—¶åˆ·æ–°ï¼Œå¯¼è‡´åç»­è¯»å–æ—¶ç¼“å†²åŒºæ•°æ®è¿˜æœªå†™å…¥ç£ç›˜
   - è§£å†³ï¼šåœ¨ `countTopKWords()` ä¸­æ¯æ¬¡éƒ½åˆ›å»ºå±€éƒ¨æµå¯¹è±¡ï¼Œå†™å®Œç«‹å³å…³é—­
   ```cpp
   void HaEngineSSE::countTopKWords(std::ofstream& out) 
   {
       // åˆ›å»ºæœ¬åœ°æµå¯¹è±¡ï¼Œæ¯æ¬¡éƒ½è¦†ç›–æ–‡ä»¶
       std::ofstream localOut(outputFile, std::ios::out | std::ios::trunc);
       
       // ... å†™å…¥JSONæ•°æ® ...
       
       localOut << jsonStr << std::endl;
       localOut.flush();  // ç¡®ä¿åˆ·æ–°ç¼“å†²åŒº
       localOut.close();  // å…³é—­æ–‡ä»¶
   }
   ```
   è¿™æ ·ç¡®ä¿æ¯æ¬¡å†™å…¥éƒ½å®Œæ•´åˆ·æ–°åˆ°ç£ç›˜ï¼Œé¿å…è¯»å–åˆ°ç©ºæ•°æ®æˆ–æ—§æ•°æ®

#### 2. **å¹¶å‘å†²çªé—®é¢˜**
   - ç°è±¡ï¼šæ—¥å¿—æ˜¾ç¤ºæ¨é€é¡ºåºæ··ä¹±ï¼Œç¬¬10æ¬¡æ¨é€ï¼ˆ540sï¼‰å’Œç¬¬11æ¬¡æ¨é€ï¼ˆ600sï¼‰ä¹‹é—´æ’å…¥äº†ç¬¬56æ¬¡æ¨é€ï¼ˆ3300sï¼‰
   ```
   [SSE] ç¬¬10æ¬¡æ¨é€: timestamp=540
   [SSE] ç¬¬56æ¬¡æ¨é€: timestamp=3300  // é¡ºåºé”™ä¹±
   [SSE] ç¬¬11æ¬¡æ¨é€: timestamp=600
   ```
   - åŸå› ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶å‘èµ·æ»šåŠ¨åˆ†æè¯·æ±‚æ—¶ï¼Œæ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ `temp_input.txt` å’Œ `temp_output.txt`
   ```cpp
   // é”™è¯¯åšæ³•ï¼šå›ºå®šæ–‡ä»¶åå¯¼è‡´å¹¶å‘å†²çª
   std::string tempInput = "temp_input.txt";
   std::string tempOutput = "temp_output.txt";
   ```
   å¤šä¸ª SSE è¿æ¥åŒæ—¶å†™å…¥å’Œè¯»å–åŒä¸€æ–‡ä»¶ï¼Œå¯¼è‡´æ•°æ®äº¤å‰è¦†ç›–
   
   - è§£å†³åŠæ³•ï¼šä½¿ç”¨æ—¶é—´æˆ³ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„ä¸´æ—¶æ–‡ä»¶å
   ```cpp
   // ä½¿ç”¨æ—¶é—´æˆ³ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
   auto timestamp = std::chrono::system_clock::now().time_since_epoch().count();
   std::string tempInput = "stream_temp_input_" + std::to_string(timestamp) + ".txt";
   std::string tempOutput = "stream_temp_output_" + std::to_string(timestamp) + ".txt";
   ```
   æ¯ä¸ª SSE è¿æ¥ä½¿ç”¨ç‹¬ç«‹æ–‡ä»¶ï¼Œé¿å…å¹¶å‘å†²çªã€‚åŒæ—¶åœ¨æ¨é€å®Œæˆåæ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼š
   ```cpp
   // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
   std::remove(tempInput.c_str());
   std::remove(tempOutput.c_str());
   ``` 

#### 3. **å®¢æˆ·ç«¯æ–­å¼€è¿æ¥åä»æŒç»­æ¨é€æ•°æ®**
   - **ç°è±¡**ï¼šå‰ç«¯ç‚¹å‡»åœæ­¢æŒ‰é’®åï¼Œç»ˆç«¯ä»æ˜¾ç¤ºåç«¯åœ¨æŒç»­æ¨é€æ•°æ®
   - **åŸå› **ï¼šSSE æ¨é€å¾ªç¯æœªæ£€æµ‹è¿æ¥çŠ¶æ€ï¼Œå³ä½¿å®¢æˆ·ç«¯å–æ¶ˆè¯»å–ï¼Œåç«¯ä»åœ¨æ‰§è¡Œæ•°æ®å¤„ç†å’Œå†™å…¥æ“ä½œ
   - **è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨å¾ªç¯ä¸­æ£€æµ‹è¿æ¥çŠ¶æ€ï¼ŒåŠæ—¶ç»ˆæ­¢æ¨é€
   ```cpp
   while (hasMoreData) {
       // æ£€æŸ¥è¿æ¥æ˜¯å¦å·²æ–­å¼€
       if (!sink.is_writable()) {
           std::cout << "[SSE] å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥ï¼Œåœæ­¢æ¨é€" << std::endl;
           break;
       }
       
       // ... å¤„ç†æ•°æ® ...
       
       // æ¨é€æ•°æ®ï¼Œæ£€æŸ¥å†™å…¥æ˜¯å¦æˆåŠŸ
       if (!sink.write(sseMessage.c_str(), sseMessage.size())) {
           std::cout << "[SSE] å†™å…¥å¤±è´¥ï¼Œå®¢æˆ·ç«¯å¯èƒ½å·²æ–­å¼€" << std::endl;
           break;
       }
   }
   ```
   ä½¿ç”¨ `sink.is_writable()` åœ¨æ¯æ¬¡å¾ªç¯å¼€å§‹å‰æ£€æµ‹è¿æ¥ï¼Œå¹¶é€šè¿‡ `sink.write()` çš„è¿”å›å€¼åˆ¤æ–­å†™å…¥æ˜¯å¦æˆåŠŸã€‚

### 4. **Web ä»£ç é‡æ„çš„é—®é¢˜**
éšç€åŠŸèƒ½çš„å¢å¤šï¼Œ`index.html`çš„ä»£ç è¶Šæ¥è¶Šé•¿ï¼Œäºæ˜¯å°†æ ·å¼å’Œ JavaScript è„šæœ¬ä» HTML ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œè®© HTML å¼•å…¥ã€‚
- **ç°è±¡**ï¼šå‰ç«¯æ— æ³•ä¸Šä¼ æ–‡ä»¶
- **åŸå› **ï¼šHTML åœ¨ `<head>` ä¸­åŠ è½½ `script.js`ï¼Œ`js`ä¼šè¯»å– DOM å…ƒç´ æ—¶ï¼Œä½†æ˜¯æ­¤æ—¶è¿™äº› DOM å…ƒç´ è¿˜ä¸å­˜åœ¨ï¼Œå› ä¸º HTML çš„ `<body>` éƒ¨åˆ†è¿˜æ²¡æœ‰å¼€å§‹ï¼Œæ‰€ä»¥è¿™äº›å˜é‡éƒ½æ˜¯`null`
```js
const fileInput = document.getElementById('fileInput');
const resultDiv = document.getElementById('result');
const uploadArea = document.querySelector('.upload-area');
const fileStatus = document.getElementById('fileStatus');
const fileName = document.getElementById('fileName');
const analyzeBtn = document.getElementById('analyzeBtn');
```
- **è§£å†³åŠæ³•**ï¼šå¼•å…¥ js è„šæœ¬æ—¶æ·»åŠ  `defer` å±æ€§ï¼Œç¡®ä¿è„šæœ¬åœ¨ DOM è§£æä¹‹åå†æ‰§è¡Œã€‚
```html
<script src="script.js" defer></script>
```

## v1.8 å¼•å…¥ Catch2 æµ‹è¯•æ¡†æ¶è¿›è¡Œå•å…ƒæµ‹è¯•

### **`HaEngineSSE`ç±»ä¸­çš„`cutWord()` å‡½æ•°é”™è¯¯å¯¼è‡´å¤šå¤„ç†ä¸€è¡Œæ•°æ®**
   - **ç°è±¡**ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹éªŒè¯ `step=10` æ—¶åº”è¯¥åªå¤„ç† 0sã€5sã€9s çš„æ•°æ®ï¼Œä¸åº”å¤„ç† 15s çš„æ•°æ®ã€‚**ä½†æµ‹è¯•å¤±è´¥**ï¼Œè‘¡è„ï¼ˆ15s æ—¶é—´æˆ³ï¼‰çš„è®¡æ•°ä¸º 4 è€Œä¸æ˜¯é¢„æœŸçš„ 0
   ```cpp
   std::vector<std::string> lines = {
       "[0:00:00] è‹¹æœ è‹¹æœ",
       "[0:00:05] é¦™è•‰ é¦™è•‰ é¦™è•‰",
       "[0:00:09] æ©™å­ æ©™å­",
       "[0:00:15] è‘¡è„ è‘¡è„ è‘¡è„ è‘¡è„"  // ä¸åº”è¢«å¤„ç†
   };
   
   engine.cutWord();
   REQUIRE(getWordCount(output, "è‘¡è„") == 0);  // å¤±è´¥: 4 == 0
   ```
   
   - **åŸå› **ï¼š`cutWord()` å¾ªç¯é€»è¾‘å­˜åœ¨é”™è¯¯
   ```cpp
   // é”™è¯¯çš„å®ç°
   while (TWManager.getCurrentTime() < threshold) 
   {
       // å…ˆè¯»å–å¹¶å¤„ç†å½“å‰è¡Œ
       std::string line = lines[lineIndex++];
       // ... å¤„ç†æ•°æ® ...
       
       // ç„¶åæ‰æ£€æŸ¥æ—¶é—´æˆ³ï¼ˆæ­¤æ—¶æ£€æŸ¥çš„æ˜¯å·²å¤„ç†è¡Œçš„æ—¶é—´ï¼‰
   }
   ```
   å¾ªç¯æ¡ä»¶æ£€æŸ¥çš„æ˜¯**ä¸Šä¸€è¡Œ**çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯**å³å°†å¤„ç†çš„è¡Œ**çš„æ—¶é—´æˆ³ã€‚å¯¼è‡´å½“ `lineIndex` æŒ‡å‘ç¬¬ 4 è¡Œï¼ˆ15sï¼‰æ—¶ï¼Œå¾ªç¯æ¡ä»¶æ£€æŸ¥çš„æ˜¯ç¬¬ 3 è¡Œï¼ˆ9sï¼‰çš„æ—¶é—´æˆ³ï¼Œåˆ¤æ–­ `9 < 10` ä¸ºçœŸï¼Œäºæ˜¯å¤„ç†äº†ç¬¬ 4 è¡Œï¼Œå¤šå¤„ç†äº†ä¸€è¡Œæ•°æ®
   
   - **è§£å†³æ–¹æ¡ˆ**ï¼šé‡æ„å¾ªç¯é€»è¾‘ï¼Œå…ˆé¢„è¯»æ—¶é—´æˆ³ï¼Œåˆ¤æ–­åå†å†³å®šæ˜¯å¦å¤„ç†
   ```cpp
   // æ­£ç¡®çš„å®ç°
   while (lineIndex < lines.size())
   {
       // å…ˆé¢„è¯»ä¸‹ä¸€è¡Œçš„æ—¶é—´æˆ³
       std::string line = lines[lineIndex];
       std::smatch match;
       if (!std::regex_search(line, match, timeRegex)) break;
       
       int timeSec = parseTime(match[1].str());
       
       // åˆ¤æ–­æ˜¯å¦è¶…å‡ºå½“å‰æ­¥è¿›çš„æ—¶é—´èŒƒå›´
       if (timeSec >= threshold) 
          break;
       
       // ç¡®è®¤åœ¨èŒƒå›´å†…ï¼Œæ‰å¤„ç†è¿™ä¸€è¡Œ
       lineIndex++;
       // ... å¤„ç†æ•°æ® ...
   }
   ```
åŒæ ·çš„ä¿®å¤ä¹Ÿåº”ç”¨åˆ°äº† `cutWordFilter()` å’Œ `cutWordChooser()` å‡½æ•°ä¸­ï¼Œç¡®ä¿æ‰€æœ‰åŸºäºæ­¥è¿›çš„åˆ†è¯å‡½æ•°éƒ½æ­£ç¡®å¤„ç†æ—¶é—´è¾¹ç•Œ






